# Списки аргументов переменной длины с обязательными аргументами

Возьмём пример из [официальной документации PHP](https://www.php.net/manual/ru/functions.arguments.php#functions.variable-arg-list) и посмотрим, что с ним не так:

```PHP
<?php
function sum(...$numbers) {
    $acc = 0;
    foreach ($numbers as $n) {
        $acc += $n;
    }
    return $acc;
}

echo sum(1, 2, 3, 4);
// пример закончился, ниже я добавил примеры того, что не так:

// Cумма ноля значений.
echo sum();

// Да, этот код выбросит исключение при выполнении тела функции,
// но (1) такой код не подсвечивается IDE,
// и (2) ошибки лучше выявлять раньше: при вызове, а не в теле функции.
echo sum(1, 'bullshit', new stdClass);
```

Если вы думаете, что последняя ситуация гротескна, и программисты не настолько глупы, чтоб допустить такое, то вы слишком хорошего мнения о способностях людей. \
С вероятностью около ноля кто-то явно передаст при вызове что-то, кроме числа, но косвенным образом вполне возможно попадание туда неожиданных значений.

Добавляем объявление типа (предполагаем, что работаем только с целыми числами) и проверяем количество аргументов:

```PHP
<?php
function sum(int ...$numbers): int {
    $nArgs = count($numbers);
    if ($nArgs < 2) {
        throw new ArgumentCountError(
            'Too few arguments to function ' . __FUNCTION__ . ", $nArgs passed and at least $minArgs expected"
        );
    }
    $acc = 0;
    foreach ($numbers as $n) {
        $acc += $n;
    }
    return $acc;
}
```

Уже лучше, но:

1. Нам нужно помнить, какое исключение выбросить, а также какой формат сообщения использовать.
2. IDE всё ещё не подсвечивает ошибочную конструкцию `sum()`.

Пусть PHP сделает за нас работу:

```PHP
<?php
function sum(int $n1, int $n2, int ...$numbers): int {
    $acc = $n1 + $n2;
    foreach ($numbers as $n) {
        $acc += $n;
    }
    return $acc;
}
```

Готово!

Стоит ли тратить время на подобный микрорефакторинг и на микропаттерны? \
Да, стоит. \
Чистота кода начинается с мелочей; нет никаких больших секретов успешного программирования, этаких серебряных пуль, но есть сотни и тысячи маленьких. \
Когда вы набираетесь опыта, вы сразу пишете код в соответствии с микропаттернами, и это тот случай, когда сделать более качественно занимает столько же или незначительно больше времени, чем сделать менее качественно: в данном примере видно, что значимое улучшение достигается добавлением двух-трёх десятков символов.
